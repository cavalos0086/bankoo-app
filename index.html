<html ng-app="bankooTest">
	<head>
	<script src="bower_components/angular/angular.min.js"></script>
	<script>
		angular.module("bankooTest", [])
			.run(run)
			.controller("mainController", mainController);

		function run(){
			if(window.PaymentRequest) {
				initPaymentRequestApi();
			} else {
				console.log("Payment Request Not Found");
			}

		}

		function initPaymentRequestApi() {
			var supportedPaymentMethods = [{
				supportedMethods: ["https://oceanhuang-github-io-bankoo.herokuapp.com/"],
				data: {
					merchantName: 'Bankoo',
					checkoutObject: {
						theKey1: 'theKey',
						theKey2: 'theSameThingKey',
						theKey3: 'theKey',
						theKey4: 'theKey',
						theKey6: 'theKey',
						theKey14: 'theKey',
						theKey9: 'theKey',
						theKey7: 'theKey',
						theKey21: 'theKey',
						theKey13: 'theKey',
						theKey20: 'theKey',
						theKey15: 'theKey',
						theKey20: 'theKey'
					}
				},
			}];

			var paymentDetails = {
				total: {
					label: 'mechantName',
					amount: {
						currency: 'USD',
						value: '20',
					},
				},
			};

			window.paymentRequest = new window.PaymentRequest(supportedPaymentMethods, paymentDetails);

			var supportedPaymentMethods = [{
				supportedMethods: ["172.20.100.219:8000/"],
				data: {
					merchantName: 'Biiiiiii',
					checkoutObject: {
						theKey1: 'theKeyiiiiii:i',
						theKey2: 'theSameThingKey',
						theKey3: 'theKey',
						theKey4: 'theKey',
						theKey6: 'theKey',
						theKey14: 'theKey',
						theKey9: 'theKey',
						theKey7: 'theKey',
						theKey21: 'theKey',
						theKey13: 'theKey',
						theKey20: 'theKey',
						theKey15: 'theKey',
						theKey20: 'theKey'
					}
				},
			}];

			var paymentDetails = {
				total: {
					label: 'mechantName',
					amount: {
						currency: 'USD',
						value: '20',
					},
				},
			};
			window.paymentRequest = new window.PaymentRequest(supportedPaymentMethods, paymentDetails);
		}

		function mainController($scope){
			var vm = this;
			vm.isSecureContext = window.isSecureContext;
			vm.handleClick = handleClick;
			vm.apiPresent = !!window.PaymentRequest;

			if(window.paymentRequest){
				window.paymentRequest.canMakePayment()
					.then(canMakePaymentResponse)
					.catch(handleError);
			}

			function canMakePaymentResponse(result){
				vm.canMakePayment = result;
				$scope.$apply();
			}

			function handleError(err) {
				console.log(err);
			}

			function handleClick(e){
				window.paymentRequest.show()
					.then(handleResponse)
					.catch(handleError);
			}

			function handleResponse(checkoutResponse){
				checkoutResponse.complete('success');
			}

			function handleError(checkoutError){
				console.log(checkoutError);
			}
		}
	</script>
	</head>
	<body ng-controller="mainController as vm">
		<h1>Is Secure Context {{vm.isSecureContext}}</h1>
		<h1>Api Present {{vm.apiPresent}}</h1>
		<h1 ng-show="vm.apiPresent">Can Make Payment {{vm.canMakePayment}}</h1>
		<h1>{{vm.failed}}</h1>
		<button ng-click="vm.handleClick()">Send Request</button>
	</body>
</html>
